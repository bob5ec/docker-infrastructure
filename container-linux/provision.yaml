passwd:
  users:
    - name: core
      password_hash: "$6$bT.CKtOX$zUvsBWyE1qK3KUVIk.xyc24dQc605vigJgrti0YyjKpQ1yc6KmYUq8CL6FQ11UC3X45XNvNgJNWNzSaLb.mAq/"
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDRrv5XeKyECmRaG0a2NoovFWJJgP91/Xrcei2m5QNKkzpAcj7W2wJfM1n4qRAqwKKLJXeIWuLc+uoRLBVl2WyfKf5sQnGEWdommyubRYXi9EWSRf08XPNGntNKJRBqVLvYfg8PWFuqmhzKhgA2mT+kXcKlPtHvq60banc8gZHuPH+r7VSSsgOaBYPNvtIm3Tzzrgy3omXrgtWVUbCuYkdg2Q6y+tPM5W5EeeviqESsc1+hjQu5U3Qp/1emC+7dkLuBfuwb1VeMWcmp4v4juPc4T+aUMZLQ+xXqE3JofJP1g9ncgPKsdU6BKTcDzafhs3QswIB79El1QGZJDiMUHQ7D"
    - name: test2
      password_hash: "$6$bT.CKtOX$zUvsBWyE1qK3KUVIk.xyc24dQc605vigJgrti0YyjKpQ1yc6KmYUq8CL6FQ11UC3X45XNvNgJNWNzSaLb.mAq/"
networkd:
  units:
    - name: static.network
      contents: |
        [Match]
        Name=eth0

        [Network]
        Address=192.168.3.2/24
        Gateway=192.168.3.1
        DNS=192.168.1.1

systemd:
  units:
    - name: compose.service
      enabled: true
      contents: |
        [Unit]
        Description=Docker Compose
        After=docker.service
        Requires=docker.service
        
        [Service]
        TimeoutStartSec=0
        ExecStartPre=-/usr/bin/docker kill busybox1
        ExecStartPre=-/usr/bin/docker rm busybox1
        ExecStartPre=/usr/bin/docker pull busybox
        ExecStart=/usr/bin/docker run --name busybox1 busybox /bin/sh -c "trap 'exit 0' INT TERM; while true; do echo Hello World; sleep 1; done"
        
        [Install]
        WantedBy=multi-user.target

#TODO run a docker swarm
#TODO run docker compose on swarm
#TODO add etcd for coordinated reboot: https://coreos.com/etcd/docs/latest/v2/admin_guide.html

# TODO lock-down-the-internet.com
#systemd:
#  units:
#    - name: docker.service
#      enable: true
#      dropins:
#        - name: 20-http-proxy.conf
#          contents: |
#            [Service]
#            Environment="HTTP_PROXY=http://proxy.example.com:8080"
