---

#TODO move basics to task that requires them
- name: apply basic configuration to all nodes
  hosts: all
  remote_user: root

  roles:
    - basics

- name: configure and deploy libvirt
  hosts: all
  remote_user: root

  roles:
    - hypervisor

#TODO create vlan bridge interface within /etc/network/interfaces and connect the net to it
#auto dev
#iface dev inet manual
#        bridge_ports eth0.2
#        bridge_stp off
#        bridge_maxwait 0
#        bridge_fd 0

# [WARNING]: It is unnecessary to use '{{' in loops, leave variables in loop expressions bare.
#ERROR: [DEPRECATED]: include + with_items is a removed deprecated feature (in /etc/ansible/roles/dresden-weekly.network-interfaces/handlers/main.yml).  Please update your playbooks.

#TODO https://github.com/dresden-weekly/ansible-network-interfaces/issues/61
- name: create VLANs and network interfaces
  hosts: all
  remote_user: root

  roles:
    - role: dresden-weekly.network-interfaces
      network_manage_devices: yes

      network_interfaces:
      - device: vlan123
        description: sample vlan interface using eth0 and tagged for VLAN 123.
        method: static
        address: 10.1.1.2
        netmask: 24
        broadcast: 10.1.1.255
        vlan:
          raw-device: eth0

- name: create VMs
  hosts: all
  remote_user: root

  roles:
    - vms
#
#- name: deploy MySQL and configure the databases
#  hosts: vm
#  remote_user: root
#
#  roles:
#    - vm
